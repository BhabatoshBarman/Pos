<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>POS Bill - ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø Adda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: "Noto Sans Bengali","Segoe UI",Arial,sans-serif; margin:0; padding:10px; font-size:14px; color:#000; background:#fdfdfd; }
    header, footer { text-align:center; }
    header h2 { margin:0; font-size:18px; }
    header p { margin:2px 0; font-size:13px; }
    hr { border:none; border-top:1px dashed #555; margin:5px 0; }
    .settings-container { position:absolute; top:10px; right:15px; }
    .settings-btn { background:none; border:none; font-size:22px; cursor:pointer; }
    .dropdown { display:none; position:absolute; right:0; margin-top:5px; background:#fff; border:1px solid #ccc; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.15); z-index:100; }
    .dropdown a { display:block; padding:8px 12px; text-decoration:none; color:#000; font-size:14px; }
    .dropdown a:hover { background:#f1f1f1; }
    .controls { display:flex; flex-wrap:wrap; gap:8px; margin:10px 0; align-items:center; }
    select, input { padding:5px; font-size:14px; border:1px solid #ccc; border-radius:5px; min-width:100px; }
    button { background:#008e18; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:14px; }
    button:active { background:#007314; }
    table { width:100%; border-collapse:collapse; margin-top:8px; font-size:13px; }
    th, td { border-bottom:1px dashed #aaa; padding:6px; text-align:center; }
    th { font-size:14px; background:#f3f3f3; }
    #grandTotal { text-align:right; margin-top:8px; font-weight:bold; font-size:15px; }
    .upi-payment { text-align:center; margin-top:12px; }
    #upiQR { margin:auto; margin-top:6px; }
    footer p { font-size:12px; margin:3px 0; }
    .modal { display:none; position:fixed; z-index:200; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    .modal-content { background:#fff; margin:10% auto; padding:15px; border-radius:8px; width:90%; max-width:400px; }
    .modal-header { font-weight:bold; margin-bottom:10px; }
    .close { float:right; font-size:18px; cursor:pointer; }
    @media print { button, select, input, .settings-container { display:none !important; } @page { size:58mm auto; margin:3mm; } body { background:#fff; font-size:12px; } }
  </style>
</head>
<body>
  <!-- Settings -->
  <div class="settings-container">
    <button class="settings-btn" onclick="toggleDropdown()">‚öôÔ∏è</button>
    <div class="dropdown" id="settingsMenu">
      <a href="#" onclick="openModal('productModal')">‚ûïProduct</a>
      <a href="#" onclick="openModal('reportModal')">üìäReport</a>
    </div>
  </div>

  <header>
    <h2>üç¥ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø Adda üç¥</h2>
    <p>Near Bhatri Club, Gangarampur</p>
    <p>‚òé +91 9064899089 / +91 8759208612 ‚òé</p>
    <p>Date: <span id="billDate"></span> | Bill No: <span id="billNo"></span></p>
    <hr>
  </header>

  <!-- Qty Selector -->
  <div class="controls">
    <label>Qty:
      <select id="qty">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option><option value="6">6</option>
        <option value="7">7</option><option value="8">8</option>
        <option value="9">9</option><option value="10">10</option>
      </select>
    </label>
  </div>

  <!-- Product Menu Buttons -->
  <div id="menuContainer" class="controls" style="flex-wrap:wrap; justify-content:flex-start;">
    <!-- JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶∏‡¶¨‡ßá -->
  </div>

  <!-- Bill table -->
  <table id="bill">
    <tr>
      <th>Item</th>
      <th>Qty</th>
      <th>Rate</th>
      <th>Total</th>
    </tr>
  </table>

  <div id="grandTotal">Grand Total: 0 ‚Çπ</div>
  <div style="text-align:center">
    <button onclick="printBill()">üñ®Ô∏è Print Bill</button>
  </div>

  <!-- UPI QR -->
  <div class="upi-payment">
    <p><b>Pay via UPI</b></p>
    <div id="upiQR"></div>
  </div>

  <footer>
    <hr>
    <p>üôè ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶¨‡ßá‡¶® üôè</p>
    <p>¬© 2025 ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø Adda</p>
  </footer>

  <!-- Product Modal -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('productModal')">&times;</span>
      <div class="modal-header">‚ûï Product Manager</div>
      <input type="text" id="newProductName" placeholder="Product Name"><br><br>
      <input type="number" id="newProductPrice" placeholder="Price"><br><br>
      <button onclick="addNewProduct()">Add Product</button>
      <hr>
      <label>Remove Product:</label>
      <select id="removeProduct"></select>
      <button onclick="removeProduct()">‚ùå Remove</button>
    </div>
  </div>

  <!-- Report Modal -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('reportModal')">&times;</span>
      <div class="modal-header">üìä Sales Report</div>
      <button onclick="showTodayReport()">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button><br><br>
      From: <input type="date" id="fromDate">
      To: <input type="date" id="toDate">
      <button onclick="showRangeReport()">Search</button>
      <div id="reportResult" style="margin-top:10px; max-height:200px; overflow:auto;"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.9.2/lib/qr-code-styling.js"></script>

  <script>
  // Firebase config (dummy values, replace with real)
  const firebaseConfig = {
    apiKey: "AIzaSyDpXWvmtI_wIOXueQadSWS6cJA8nbqqPWA",
    authDomain: "biryani-ada-pos-bill.firebaseapp.com",
    projectId: "biryani-ada-pos-bill",
    storageBucket: "biryani-ada-pos-bill.firebasestorage.app",
    messagingSenderId: "397191320972",
    appId: "1:397191320972:web:570a8769d545fa229772a9",
    measurementId: "G-CPRT2R6HCQ"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let total = 0;
  let today = new Date();
  let todayStr = today.toISOString().split('T')[0];
  let billNo = 0;
  let qr;

  // Default products
  let products = [
    {name:"‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø", price:90},
    {name:"‡¶ú‡¶≤‡ßá‡¶∞ ‡¶¨‡ßã‡¶§‡¶≤", price:10},
    {name:"‡¶≠‡ßá‡¶ú ‡¶ö‡¶æ‡¶â‡¶Æ‡¶ø‡¶®", price:40},
    {name:"‡¶è‡¶ó ‡¶ö‡¶æ‡¶â‡¶Æ‡¶ø‡¶®", price:50},
    {name:"‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶ö‡¶æ‡¶â‡¶Æ‡¶ø‡¶®", price:70},
    {name:"‡¶è‡¶ó ‡¶∞‡ßã‡¶≤", price:30},
    {name:"‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶∞‡ßã‡¶≤", price:50},
    {name:"‡¶∏‡ßç‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ü ‡¶¨‡ßã‡¶§‡¶≤ ‡ß®‡ß¶ml", price:20}
  ];

  // Load product buttons
  function loadProducts() {
    let menuDiv = document.getElementById("menuContainer");
    let removeSelect = document.getElementById("removeProduct");
    menuDiv.innerHTML = "";
    removeSelect.innerHTML = "";

    products.forEach(p => {
      // Menu button
      let btn = document.createElement("button");
      btn.textContent = `${p.name} (‚Çπ${p.price})`;
      btn.onclick = () => addMenuItem(p.name, p.price);
      menuDiv.appendChild(btn);

      // Remove option
      let opt2 = document.createElement("option");
      opt2.value = p.name; opt2.textContent = p.name;
      removeSelect.appendChild(opt2);
    });
  }

  function addNewProduct(){
    let name = document.getElementById("newProductName").value.trim();
    let price = parseInt(document.getElementById("newProductPrice").value);
    if(name && price){
      products.push({name, price});
      loadProducts();
      db.collection("products").add({name, price});
      document.getElementById("newProductName").value = "";
      document.getElementById("newProductPrice").value = "";
    }
  }

  function removeProduct(){
    let name = document.getElementById("removeProduct").value;
    products = products.filter(p => p.name !== name);
    loadProducts();
  }

  function openModal(id){ document.getElementById(id).style.display="block"; }
  function closeModal(id){ document.getElementById(id).style.display="none"; }
  function toggleDropdown(){ 
    let menu = document.getElementById("settingsMenu"); 
    menu.style.display = menu.style.display==="block" ? "none" : "block"; 
  }

  function formatBillNo(num){ return String(num).padStart(3,'0'); }
  function formatDate(date){ return `${String(date.getDate()).padStart(2,'0')}/${String(date.getMonth()+1).padStart(2,'0')}/${date.getFullYear()}`; }

  function initBillNo(){
    document.getElementById("billNo").innerText = formatBillNo(1);
    document.getElementById("billDate").innerText = formatDate(today);
  }

  // QR update
  function updateQR(){
    const upiId = "9064899089@ptaxis";
    const payeeName = "Biryani Adda";
    const upiLink = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${total}`;
    if(!qr){ 
      qr = new QRCodeStyling({width:120, height:120, data:upiLink}); 
      qr.append(document.getElementById("upiQR")); 
    } else qr.update({data:upiLink});
  }

  // Add item from button
  function addMenuItem(itemName, price){
    let qty = parseInt(document.getElementById("qty").value);
    let lineTotal = price * qty;

    let table = document.getElementById("bill");
    let row = table.insertRow();
    row.insertCell(0).innerText = itemName;
    row.insertCell(1).innerText = qty;
    row.insertCell(2).innerText = price;
    row.insertCell(3).innerText = lineTotal;

    total += lineTotal;
    document.getElementById("grandTotal").innerText = "Grand Total: " + total.toFixed(2) + " ‚Çπ";
    updateQR();
  }

  function printBill(){
    window.print();
    window.onafterprint = () => {
      // Save bill
      let billData = {
        date: todayStr,
        billNo: formatBillNo(billNo),
        amount: total
      };
      db.collection("bills").add(billData);

      // Reset
      billNo++;
      document.getElementById("billNo").innerText = formatBillNo(billNo);
      document.getElementById("bill").innerHTML = '<tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th></tr>';
      total = 0;
      document.getElementById("grandTotal").innerText = "Grand Total: 0 ‚Çπ";
      updateQR();
    };
  }

  // Report
  function showTodayReport(){
    db.collection("bills").where("date","==",todayStr).get().then(snapshot=>{
      let data = snapshot.docs.map(doc=>doc.data());
      showReportData(data,"‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü");
    });
  }

  function showRangeReport(){
    let from = document.getElementById("fromDate").value;
    let to = document.getElementById("toDate").value;
    if(!from || !to){ alert("‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®"); return; }
    db.collection("bills").where("date",">=",from).where("date","<=",to).get().then(snapshot=>{
      let data = snapshot.docs.map(doc=>doc.data());
      showReportData(data,`${from} ‡¶•‡ßá‡¶ï‡ßá ${to} ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü`);
    });
  }

  function showReportData(data, title){
    let result = document.getElementById("reportResult");
    let totalSale = data.reduce((sum, h)=>sum+h.amount, 0);
    let html = `<h4>${title}</h4>`;
    if(data.length === 0){ html += "<p>No data found</p>"; }
    else {
      html += `<p><b>Total Sale: ‚Çπ${totalSale}</b></p>`;
      html += "<table border='1' width='100%' style='border-collapse:collapse;'><tr><th>Date</th><th>Bill No</th><th>Amount</th></tr>";
      data.forEach(h=>{ html += `<tr><td>${h.date}</td><td>${h.billNo}</td><td>‚Çπ${h.amount}</td></tr>`; });
      html += "</table>";
    }
    result.innerHTML = html;
  }

  // Init
  loadProducts();
  initBillNo();
  updateQR();
  </script>
</body>
</html>
